<div id="map" data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>" data-markers="<%=  @markers.to_json %>">
  <div class="container">
        <h1 class="text-center">Finish</h1>
        <div class="fixed-bottom">
          <% if params[:complete] == "true" %>
            <button id="map-btn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">Finish</button>
          <% else %>
            <%= link_to "Finish", attempt_path(@attempt, complete: true), class: "btn btn-primary", id: "map-btn" %>
          <% end %>

        </div>
  </div>
</div>
  <!-- <div id="instructions"></div> -->

<% if params[:complete] == "true" %>
  <% current_user.routes_completed += 1 %>
  <% current_user.distance_cycled += @cycle_route.total_distance %>
  <% @attempt.end_time = DateTime.current %>
  <% @attempt.save %>
  <% current_user.save %>
  <!-- <script>document.getElementById("route-time").insertAdjacentHtml("beforeend", "some seconds")</script> -->
  <script>
    document.addEventListener("turbolinks:load", () => {
      document.getElementById("map-btn").click()
    })
  </script>
<% end %>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Well Done!!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h5>Distance Cycled: <%= @cycle_route.total_distance %> mi</h5>
        <h5 id="route-time">Time to complete route: <%= (@attempt.end_time&.to_datetime - @attempt.start_time.to_datetime).to_i/1000 if @attempt.end_time %> seconds</h5>
      </div>

      <div class="modal-footer justify-content-center">
        <%= link_to "Collect your Rewards", user_path(current_user), method: :get, class: 'btn btn-primary', id: "btn-modal" %>
        <%= link_to "Write a Review", new_cycle_route_review_path(@cycle_route), method: :get, class: 'btn btn-success', id: "btn-modal" %>
        <%= link_to "Choose another Route", root_path, method: :get, class: 'btn btn-outline-primary', id: "btn-modal" %>
      </div>
    </div>
  </div>
</div>

<!-- When you complete an attempt, you need to update the users
      total distance traveled, routes completed, and mark the current
      attempt as complete.

      Create a new route whe

      In order to give awards when a route is completed, do we need a new route?
      You can create rules for automatic merit awarding triggered by a route
      or -->
